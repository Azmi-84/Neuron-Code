// Generated by Copilot
class TurbidityMonitor {
    constructor() {
        this.chart = null;
        this.init();
    }

    init() {
        this.updateDateTime();
        this.initChart();
        this.startDataSimulation();
        this.updateInterval = setInterval(() => {
            this.updateDateTime();
            this.simulateNewData();
        }, 30000); // Update every 30 seconds
    }

    updateDateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-US', { 
            hour: '2-digit', 
            minute: '2-digit' 
        });
        document.getElementById('last-update').textContent = timeString;
    }

    initChart() {
        const ctx = document.getElementById('turbidityChart').getContext('2d');
        
        // Generate sample data for the last 24 hours
        const data = this.generateSampleData();
        
        this.chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Turbidity (NTU)',
                    data: data.values,
                    borderColor: '#2563eb',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            maxTicksLimit: 6
                        }
                    },
                    y: {
                        beginAtZero: true,
                        max: 5,
                        grid: {
                            color: '#e2e8f0'
                        },
                        ticks: {
                            stepSize: 1
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            }
        });
    }

    generateSampleData() {
        const now = new Date();
        const labels = [];
        const values = [];
        
        for (let i = 23; i >= 0; i--) {
            const time = new Date(now - i * 60 * 60 * 1000);
            labels.push(time.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            }));
            
            // Generate realistic turbidity values (0-5 NTU)
            const baseValue = 2.0;
            const variation = (Math.sin(i / 4) + Math.random() - 0.5) * 0.8;
            values.push(Math.max(0, Math.min(5, baseValue + variation)));
        }
        
        return { labels, values };
    }

    simulateNewData() {
        // Generated by Copilot
        // Simulate real-time data updates
        const turbidityElement = document.getElementById('turbidity-value');
        const temperatureElement = document.getElementById('temperature-value');
        
        // Generate new values with small variations
        const currentTurbidity = parseFloat(turbidityElement.textContent);
        const newTurbidity = Math.max(0, Math.min(5, 
            currentTurbidity + (Math.random() - 0.5) * 0.2
        ));
        
        const currentTemp = parseFloat(temperatureElement.textContent);
        const newTemp = Math.max(15, Math.min(30, 
            currentTemp + (Math.random() - 0.5) * 0.5
        ));
        
        // Update display values
        turbidityElement.textContent = newTurbidity.toFixed(1);
        temperatureElement.textContent = newTemp.toFixed(1);
        
        // Update status based on turbidity
        this.updateWaterQualityStatus(newTurbidity);
        
        // Update chart
        this.updateChart(newTurbidity);
    }

    updateWaterQualityStatus(turbidity) {
        const statusElement = document.querySelector('.metric-status');
        const statusIndicator = document.querySelector('.status-indicator');
        
        let status, className;
        
        if (turbidity <= 1) {
            status = 'Excellent Quality';
            className = 'good';
        } else if (turbidity <= 4) {
            status = 'Good Quality';
            className = 'good';
        } else if (turbidity <= 10) {
            status = 'Fair Quality';
            className = 'warning';
        } else {
            status = 'Poor Quality';
            className = 'danger';
        }
        
        statusElement.textContent = status;
        statusIndicator.className = `status-indicator ${className}`;
    }

    updateChart(newValue) {
        if (this.chart) {
            const data = this.chart.data;
            const now = new Date();
            
            // Remove oldest data point
            data.labels.shift();
            data.datasets[0].data.shift();
            
            // Add new data point
            data.labels.push(now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            }));
            data.datasets[0].data.push(newValue);
            
            this.chart.update('none');
        }
    }

    startDataSimulation() {
        // Initial realistic values
        document.getElementById('turbidity-value').textContent = '2.3';
        document.getElementById('temperature-value').textContent = '22.5';
        
        this.updateWaterQualityStatus(2.3);
    }
}

// Smooth scrolling for navigation links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Initialize the monitoring system when the page loads
document.addEventListener('DOMContentLoaded', () => {
    new TurbidityMonitor();
});

// Add some interactive features
document.addEventListener('click', (e) => {
    if (e.target.closest('.card')) {
        e.target.closest('.card').style.transform = 'scale(0.98)';
        setTimeout(() => {
            e.target.closest('.card').style.transform = '';
        }, 150);
    }
});